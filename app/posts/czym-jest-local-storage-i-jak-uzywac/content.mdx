export const meta = {
  title: "Czym jest Local Storage i jak go uÅ¼ywaÄ‡?",
  seo_desc:
    "ArtykuÅ‚ odpowiadajÄ…cy na pytanie 'Czym jest Local Storage?' oraz wyjaÅ›niajÄ…cy gdzie i w jaki sposÃ³b moÅ¼emy z tego lokalnego magazynu danych korzystaÄ‡.",
  short:
    "Ten artykuÅ‚ wprowadza w Å›wiat Local Storage - integralnej funkcji przeglÄ…darek, ktÃ³ra pozwala na przechowywanie danych na poziomie klienta. Poznaj jak korzystaÄ‡ z API Local Storage, zrozum kiedy i dlaczego jest to przydatne, a takÅ¼e dowiedz siÄ™, czego unikaÄ‡ przy uÅ¼yciu tej technologii.",
  date: "2020-04-06",
  tags: ["JavaScript"],
};

W dzisiejszym artykule zastanowimy siÄ™ nad tym czym jest Local Storage oraz gdzie i jak naleÅ¼y go uÅ¼ywaÄ‡. Temat jest stosunkowo Å‚atwy i przyjemny. JeÅ¼eli dopiero zaczynasz swojÄ… przygodÄ™ z frontendem, to po przeczytaniu tego artykuÅ‚u na pewno dostrzeÅ¼esz wiele nowych moÅ¼liwoÅ›ci.

## Czym jest Local Storage?

Jak sama nazwa wskazuje, jest pewnego rodzaju â€magazynem danychâ€ w przeglÄ…darce. MoÅ¼emy z niego korzystaÄ‡ w naszych aplikacjach webowych. Z racji tego, iÅ¼ aplikacja taka bÄ™dzie napisana w JavaScript dane w tym przypadku bÄ™dÄ… przechowywane w formacie key-value. DokÅ‚adnie tak jak ma to miejsce w przypadku obiektÃ³w JavaScript:

```js
data = {
  name: "Kamil",
  frontend: true,
  age: 29,
};
```

W takim razie po co nam w ogÃ³le potrzebne coÅ› takiego? PrzecieÅ¼ moÅ¼emy rÃ³wnie dobrze zawrzeÄ‡ to w kodzie naszej aplikacji.

OtÃ³Å¼ najwiÄ™kszÄ… zaletÄ… tego lokalnego magazynu danych jest to, iÅ¼ dane te zapisujemy w pamiÄ™ci przeglÄ…darki osoby odwiedzajÄ…cej naszÄ… stronÄ™. Co wiÄ™cej, dane te sÄ… zachowywane w przeglÄ…darce nawet po jej zamkniÄ™ciu. Tak wiÄ™c aplikacja ma dostÄ™p do zapisanych informacji nawet wtedy, gdy uÅ¼ytkownik zdecyduje siÄ™ pÃ³Åºniej wrÃ³ciÄ‡ na naszÄ… stronÄ™. Chyba, Å¼e wczeÅ›niej z poziomu ustawieÅ„ przeglÄ…darki zdecyduje siÄ™ on na wyczyszczenie danych. Na to jednak nic nie poradzimy.

W jakim celu moÅ¼emy wiÄ™c wykorzystywaÄ‡ ten mechanizm:

- zapisywanie postÄ™pÃ³w w prostych grach w ktÃ³rych nie wymagamy rejestracji/logowania uÅ¼ytkownika,
- zapisywanie informacji o tym, na jakim etapie uÅ¼ytkownik jest w rÃ³Å¼nego rodzaju samouczkach,
- oznaczenie uÅ¼ytkownikÃ³w, ktÃ³rzy kliknÄ™li w nowy feature na naszej stronie,
- okreÅ›lanie, czy uÅ¼ytkownik jest zalogowany przy ponownym otwarciu przeglÄ…darki,
- przenoszenie danych pomiÄ™dzy podstronami aplikacji (chociaÅ¼ zdecydowanie lepszym rozwiÄ…zaniem jest tutaj uÅ¼ycie bibliotek do zarzÄ…dzania stanem, np. Redux).

nformacje trzymane w Local Storage sÄ… dostÄ™pne per domena. Dane zapisane przez domenÄ™ frontstack.pl nie bÄ™dÄ… mogÅ‚y byÄ‡ odczytane przez kod na stronie example.com. Nawet gdy w naszej przeglÄ…darce bÄ™dziemy mieli otwarte w dwÃ³ch kartach obie w/w strony.

## Jak korzystaÄ‡ z Local Storage?

DostÄ™p do Local Storege jest moÅ¼liwy poprzez tzw. `WEB Storage API` przeglÄ…darki. WaÅ¼nÄ… rzeczÄ… o ktÃ³rej musimy pamiÄ™taÄ‡ jest fakt, iÅ¼ nasze dane, zarÃ³wno klucze jak i wartoÅ›ci, muszÄ… byÄ‡ typu `string` (dane typu `integer` sÄ… automatycznie konwertowane na `string`).

DostÄ™p do Local Storage umoÅ¼liwia nam 5 gÅ‚Ã³wnych metod:

- `setItem(key, value)` - zapisuje wartoÅ›Ä‡ `value` pod kluczem `key`,
- `getItem(key)` - zwraca wartoÅ›Ä‡ zapisanÄ… pod kluczem `key`,
- `removeItem(key)` - usuwa wartoÅ›Ä‡ zapisanÄ… pod kluczem `key`,
- `clear()` - usuwa wszystkie dane zapisane w Local Storage,
- `key(index)` - zwraca klucz znajdujÄ…cy siÄ™ pod danym indeksem.

### setItem(key, value)

Pierwsza z metod pozwala nam na zapisywanie danych. Przyjmuje ona dwa argumenty â€“ klucz i wartoÅ›Ä‡. Poprzez klucz moÅ¼emy pÃ³Åºniej odczytaÄ‡ przypisanÄ… do niego wartoÅ›Ä‡:

```js
window.localStorage.setItem("name", "Adam Front");
```

Jak juÅ¼ wczeÅ›niej wspomniaÅ‚em, Local Storage moÅ¼e jedynie przechowywaÄ‡ dane typu `string`. JeÅ¼eli chcemy przechowaÄ‡ tablice albo obiekty, musimy najpierw wykonaÄ‡ na nich konwersjÄ™. W tym celu moÅ¼emy posÅ‚uÅ¼yÄ‡ siÄ™ metodÄ… `JSON.stringify()`:

```js
const person = {
  name: "Adam Front",
  position: "developer",
};

window.localStorage.setItem("user", JSON.stringify(person));
```

### getItem(key)

DziÄ™ki tej metodzie moÅ¼emy odczytaÄ‡ zapisane przez nas wczeÅ›niej dane. W tym przypadku podajemy tylko jeden argument â€“ klucz, dziÄ™ki ktÃ³remu moÅ¼emy odczytaÄ‡ przypisanÄ… do niego wartoÅ›Ä‡.

```js
window.localStorage.getItem("user");
```

WartoÅ›Ä‡ jakÄ… otrzymamy z powyÅ¼szego wyraÅ¼enia jest typu `string`: `â€œ{â€œnameâ€:â€Adam Frontâ€,â€positionâ€:â€developerâ€}â€{:js}` wiÄ™c musimy skonwertowaÄ‡ jÄ… ponowne do obiektu:

```js
JSON.parse(window.localStorage.getItem("user"));
```

### removeItem(key)

Gdy zdecydujemy siÄ™ na usuniÄ™cie z Local Storage dowolnej pozycji, moÅ¼emy zrobiÄ‡ to uÅ¼ywajÄ…c metody `removeItem()`, przekazujÄ…c jako argument klucz pozycji do usuniÄ™cia. Gdy jako argument podamy nieistniejÄ…cÄ… wartoÅ›Ä‡ klucza, metoda ta nic nie zrobi (nie pojawiÄ… nam siÄ™ komunikaty bÅ‚Ä™du).

### clear()

Metoda `clear()` usuwa wszystkie dane zapisane w Local Storage.

### key(index)

Metoda ta jest przydatna w przypadku, gdy musimy iterowaÄ‡ po kluczach. Pozwala nam podaÄ‡ jako argument numer bÄ…dÅº index elementu Local Storage w celu wyciÄ…gniÄ™cia jego nazwy:

```js
const KeyName = window.localStorage.key(index);
```

### length

DodatkowÄ…, bardzo przydatnÄ… property jest `length` â€“ pozwala nam ona sprawdziÄ‡, czy posiadamy jakieÅ› dane zapisane w Local Storage: `localStorage.length` (gdy = 0, nasz Local Storage jest pusty).

Istnieje rÃ³wnieÅ¼ moÅ¼liwoÅ›Ä‡ odczytu/zapisu danych w taki sam sposÃ³b jak przy typowym obiekcie JavaScript:

```js
window.localStorage.myColor = "#fff09b";
window.localStorage["myColor"] = "#fff09b";
```

jednak zdecydowanie zaleca siÄ™ uÅ¼ywanie jednej z w/w metod.

Web Storage API umoÅ¼liwia nam rÃ³wnieÅ¼ skorzystanie z SessionStorage. Zachowuje siÄ™ on niemal dokÅ‚adnie tak samo jako Local Storage. Jednak dane przechowywane w Session Storage zostajÄ… usuniÄ™te kaÅ¼dorazowo po zamkniÄ™ciu okna/karty przeglÄ…darki.

## KompatybilnoÅ›Ä‡

Local Storage jest czÄ™Å›ciÄ… specyfikacji HTML5, dziÄ™ki czemu jest dostÄ™pna na wszystkich gÅ‚Ã³wnych przeglÄ…darkach, wÅ‚Ä…czajÄ…c w to IE8. JeÅ¼eli jednak chcemy mieÄ‡ pewnoÅ›Ä‡, Å¼e przeglÄ…darka naszego uÅ¼ytkownika pozwala nam na skorzystanie z tej funkcjonalnoÅ›ci, moÅ¼emy uÅ¼yÄ‡ poniÅ¼szego kodu:

```js
if (typeof Storage !== "undefined") {
  // kod gdy Local Storage jest wspierany
} else {
  // Brak wsparcia Local Storage
}
```

## Kiedy nie stosowaÄ‡ Local Storage

- nie przechowujmy wraÅ¼liwych informacji (hasÅ‚a, klucze API) w tego typu pamiÄ™ci,
- nie jest to technologia, ktÃ³ra mogÅ‚aby w jakimkolwiek stopniu zastÄ…piÄ‡ bazÄ™ danych,
- domyÅ›lnie, rozmiar przeznaczony na Local Storage przez wiÄ™kszoÅ›Ä‡ wspÃ³Å‚czesnych przeglÄ…darek to 5MB na domenÄ™,
- Local Storage jest synchroniczna, czyli wszystkie operacje sÄ… wykonywane tylko jedna po drugiej.

## Synchronizacja miÄ™dzy kartami/oknami

Local Storage posiada jednÄ… cechÄ™, ktÃ³ra moÅ¼e byÄ‡ zarÃ³wno korzyÅ›ciÄ…, jak i wyzwaniem - jest synchronizowany miÄ™dzy wszystkimi otwartymi kartami i oknami tej samej domeny. Oznacza to, Å¼e jeÅ›li uÅ¼ytkownik otworzy dwie karty z naszÄ… stronÄ…, zmiany dokonane w Local Storage w jednej z nich bÄ™dÄ… widoczne rÃ³wnieÅ¼ w drugiej. Jest to wygodne, jeÅ›li chcemy synchronizowaÄ‡ stan miÄ™dzy kartami, ale moÅ¼e stwarzaÄ‡ problemy, jeÅ›li nie przewidzieliÅ›my takiego zachowania.

## BezpieczeÅ„stwo

Local Storage, choÄ‡ wygodny, nie jest miejscem, w ktÃ³rym powinniÅ›my przechowywaÄ‡ wraÅ¼liwych informacji, takich jak wspomniane juÅ¼ wczeÅ›niej hasÅ‚a czy klucze API. Dlaczego? PoniewaÅ¼ Local Storage jest podatny na ataki typu XSS (Cross-Site Scripting). Atak taki polega na wstrzykiwaniu zÅ‚oÅ›liwych skryptÃ³w JavaScript do naszej strony, ktÃ³re nastÄ™pnie mogÄ… odczytaÄ‡ i wykorzystaÄ‡ dane z Local Storage. Dlatego waÅ¼ne jest, aby zawsze zwracaÄ‡ uwagÄ™ na bezpieczeÅ„stwo i nie przechowywaÄ‡ w Local Storage Å¼adnych danych, ktÃ³re mogÅ‚yby byÄ‡ wykorzystane przeciwko uÅ¼ytkownikom naszej strony.

## Alternatywy dla Local Storage

ChoÄ‡ Local Storage jest bardzo uÅ¼ytecznym narzÄ™dziem, istniejÄ… teÅ¼ inne technologie przechowywania danych na stronie klienta, ktÃ³re mogÄ… lepiej pasowaÄ‡ do niektÃ³rych zastosowaÅ„. SÄ… to miÄ™dzy innymi cookies i IndexedDB. Cookies (zobacz mÃ³j wpis dotyczÄ…cy ğŸª[Cookies](/blog/cookies)) sÄ… idealne do przechowywania maÅ‚ych iloÅ›ci danych i sÄ… jedynÄ… technologiÄ…, ktÃ³ra pozwala na wysyÅ‚anie danych do serwera z kaÅ¼dym Å¼Ä…daniem. IndexedDB natomiast jest bazÄ… danych dziaÅ‚ajÄ…cÄ… w przeglÄ…darce, ktÃ³ra umoÅ¼liwia przechowywanie duÅ¼ych iloÅ›ci strukturyzowanych danych i wykonanie na nich operacji w sposÃ³b asynchroniczny. O tych technologiach bÄ™dziemy na pewno rozmawiaÄ‡ w kolejnych wpisach ğŸ™‚

## Performance

PamiÄ™taj, Å¼e nadmierna iloÅ›Ä‡ danych w Local Storage moÅ¼e wpÅ‚ynÄ…Ä‡ na wydajnoÅ›Ä‡ strony. KaÅ¼de odwoÅ‚anie do Local Storage jest operacjÄ… synchronicznÄ…, co oznacza, Å¼e blokuje ona wykonanie innych operacji do momentu zakoÅ„czenia. JeÅ›li wiÄ™c mamy duÅ¼o danych do przetworzenia, moÅ¼e to spowolniÄ‡ dziaÅ‚anie naszej strony.

## PrzykÅ‚ady uÅ¼ycia

Aby lepiej zrozumieÄ‡, jak moÅ¼na wykorzystaÄ‡ Local Storage, przyjrzyjmy siÄ™ kilku praktycznym przykÅ‚adom. MoÅ¼emy na przykÅ‚ad uÅ¼yÄ‡ Local Storage do przechowywania preferencji uÅ¼ytkownika, takich jak wybrany jÄ™zyk czy motyw strony. Innym przykÅ‚adem moÅ¼e byÄ‡ przechowywanie danych o produkcie dodanym do koszyka w sklepie internetowym - dziÄ™ki temu produkt pozostanie w koszyku nawet po zamkniÄ™ciu i ponownym otwarciu strony. MoÅ¼emy takÅ¼e uÅ¼yÄ‡ Local Storage do cache'owania danych z API - jeÅ›li uÅ¼ytkownik juÅ¼ raz pobieraÅ‚ jakieÅ› dane, moÅ¼emy je zapisaÄ‡ w Local Storage i przy nastÄ™pnym odwoÅ‚aniu uÅ¼yÄ‡ zapisanych danych zamiast ponownie pobieraÄ‡ je z serwera. To tylko kilka z wielu moÅ¼liwoÅ›ci zastosowania Local Storage.

Warto dodaÄ‡, Å¼e Local Storage dziaÅ‚a na zasadzie "pierwszy zapisuje, ostatni kasuje". Oznacza to, Å¼e jeÅ›li mamy kilka skryptÃ³w lub aplikacji korzystajÄ…cych z Local Storage na tej samej stronie, mogÄ… one nadpisywaÄ‡ dane innych skryptÃ³w. Dlatego waÅ¼ne jest, aby zawsze dokÅ‚adnie kontrolowaÄ‡, co i kiedy zapisujemy do Local Storage.

## Podsumowanie

PodsumowujÄ…c, Local Storage to potÄ™Å¼ne narzÄ™dzie, ktÃ³re pozwala nam na przechowywanie danych bezpoÅ›rednio na urzÄ…dzeniu uÅ¼ytkownika, z moÅ¼liwoÅ›ciÄ… dostÄ™pu do nich nawet po zamkniÄ™ciu i ponownym otwarciu przeglÄ…darki. Mimo Å¼e posiada pewne ograniczenia, w wielu przypadkach moÅ¼e okazaÄ‡ siÄ™ niezwykle przydatne. PamiÄ™taj jednak, aby zawsze korzystaÄ‡ z niego odpowiedzialnie i z uwzglÄ™dnieniem bezpieczeÅ„stwa danych uÅ¼ytkownikÃ³w.
