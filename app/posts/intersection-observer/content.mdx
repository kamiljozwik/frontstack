import { CodePen } from "../../components/posts";

export const meta = {
  title: "Intersection Observer - kompletny przewodnik",
  seo_desc:
    "Intersection Observer - kompletny przewodnik dla developer贸w frontend",
  short:
    "Szukasz szybkiego i prostego sposobu na wykrywanie, kiedy elementy DOM wchodz w obszar widoczny dla u偶ytkownika? Poznaj Intersection Observer i w kilka minut zmie swoj stron nie do poznania!",
  date: "2023-11-21",
  tags: ["TypeScript", "Inne"],
};

Czy zastanawiae si kiedy, jak strony internetowe wykrywaj, kiedy u偶ytkownik przescrolluje si do okrelonej sekcji? Odpowiedzi na to pytanie jest [Intersection Observer](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API). Jest to jednoczeniej proste i pot偶ne narzdzie w arsenale ka偶dego dewelopera, dziki kt贸remy mo偶emy do szybko wprowadzi kilka interesujcych funkcjonalnoci na nasz stron / do naszej aplikacji.

## Co to jest Intersection Observer?

`Intersection Observer` to natywne API przegldarki, kt贸re pozwala deweloperom na atwe i wydajne wykrywanie, kiedy element DOM przechodzi przez okrelone "obszary widocznoci", czyli tzw. `intersekcje`.

### Jak to dziaa?

API wykorzystuje obiekt `IntersectionObserver`, kt贸ry jako argumenty przyjmuje `callback` oraz obiekt konfiguracyjny. Callback jest wywoywany za ka偶dym razem, gdy obserwowany element wejdzie lub wyjdzie z obszaru okrelonego przez konfiguracj.

```typescript
const observer = new IntersectionObserver(callback, options);
```

### Prosty Przykad

Poni偶ej znajduje si prosty przykad u偶ycia obiektu `Intersection Observer`:

```typescript
const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      console.log("Element jest widoczny!");
    }
  });
});

// Zakadajc, 偶e mamy w DOM element o ID 'targetElement'
const target = document.getElementById("targetElement");
observer.observe(target);
```

## Zastosowanie w React

W React, `Intersection Observer` mo偶e by wykorzystany do tworzenia efekt贸w przewijania, lazy-loadingu obraz贸w, czy animacji element贸w przy pojawianiu si ich na ekranie.

### Przykad z u偶yciem hook贸w

U偶ycie `Intersection Observer` w React jest szczeg贸lnie proste dziki hookom. Oto przykad takiego customowego hooka:

```typescript
import { useEffect, useState } from "react";

const useIntersectionObserver = (elementRef) => {
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        setIsVisible(entry.isIntersecting);
      });
    });

    if (elementRef.current) {
      observer.observe(elementRef.current);
    }

    return () => {
      if (elementRef.current) {
        observer.unobserve(elementRef.current);
      }
    };
  }, [elementRef]);

  return isVisible;
};
```

Ten hook mo偶e by nastpnie u偶yty w dowolnym komponencie React:

```typescript
const MyComponent = () => {
  const ref = useRef();
  const isVisible = useIntersectionObserver(ref);

  return <div ref={ref}>{isVisible ? "Widoczny!" : "Niewidoczny!"}</div>;
};
```

## Dostpne opcje

Poza podstawowym zrozumieniem `Intersection Observer`, warto jest zapozna si z jego r贸偶nymi opcjami konfiguracyjnymi. Pozwalaj nam one na dostosowanie dziaania observera do konkretnych potrzeb aplikacji.

Poni偶ej znajduje si lista dostpnych opcji:

###  root

Opcja `root` pozwala okreli element, wzgldem kt贸rego ma by wykrywane przecicie. Jeli nie jest ustawiona, domylnie u偶ywany jest `viewport`.

```typescript
const options = {
  root: document.querySelector("#scrollArea"),
};
```

###  rootMargin

`rootMargin` dziaa podobnie do margines贸w w CSS. Pozwala na zdefiniowanie marginesu wok贸 `root`, kt贸ry ma by brany pod uwag przy wykrywaniu przeci.

```typescript
const options = {
  root: null,
  rootMargin: "50px 0px",
};
```

###  threshold

`threshold` okrela, jak du偶a cz obserwowanego elementu musi wej w obszar widocznoci `root`, aby zostaa wywoana funkcja `callback`. Mo偶e to by pojedyncza warto lub tablica wartoci.

```typescript
const options = {
  threshold: 0.5, // 50% elementu musi by widoczne
};
```

Zastosowanie tych opcji umo偶liwia tworzenie bardziej skomplikowanych i dostosowanych do potrzeb zachowa:

- **Lazy-loading grafiki**: Ustawienie `threshold` na nisk warto pozwala na wczeniejsze rozpoczcie adowania obraz贸w, jeszcze zanim bd w peni widoczne dla u偶ytkownika.
- **Infinite scroll**: U偶ywajc `rootMargin`, mo偶emy wyzwala adowania kolejnych treci jeszcze przed dotarciem u偶ytkownika do koca strony.
- **Animacje przy przewijaniu**: Zmienne wartoci `threshold` umo偶liwiaj uruchamianie animacji w r贸偶nych punktach wejcia elementu w obszar widocznoci.

Przykad z wykorzystaniem opcji `rootMargin`:

```typescript
const observer = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        console.log("Element jest teraz widoczny z marginesem!");
      }
    });
  },
  { rootMargin: "100px" }
);

const target = document.getElementById("targetElement");
observer.observe(target);
```

## Koniec obserwacji

Jednym z kluczowych aspekt贸w efektywnego wykorzystania `Intersection Observer` jest zarzdzanie czasem obserwacji element贸w. Wa偶ne jest, aby przesta obserwowa elementy, kt贸re ju偶 nie musz by ledzone, takie jak te usunite ze strony lub po zakoczeniu lazy-loadingu.

Aby przesta obserwowa element, nale偶y u偶y metody `unobserve` na instancji `IntersectionObserver`. Jest to kluczowe do zapobiegania wyciekom pamici i problemom z wydajnoci, szczeg贸lnie w aplikacjach o du偶ej skali i zo偶onoci.

```typescript
const observer = new IntersectionObserver((entries, obs) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      // Wykonaj potrzebne akcje
      console.log("Element jest widoczny!");

      // Przesta obserwowa element po spenieniu warunku
      obs.unobserve(entry.target);
    }
  });
});

const target = document.getElementById("targetElement");
observer.observe(target);
```

### Przykad w React:

W React, szczeg贸lnie gdy u偶ywamy hook贸w, powinnimy pamita o odczaniu obserwatora w momencie, gdy komponent jest demontowany.

```typescript
useEffect(() => {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        // Przesta obserwowa, gdy element jest widoczny
        observer.unobserve(entry.target);
      }
    });
  });

  if (ref.current) {
    observer.observe(ref.current);
  }

  return () => {
    if (ref.current) {
      observer.unobserve(ref.current);
    }
  };
}, []);
```

W aplikacjach typu SPA elementy mog by dynamicznie dodawane i usuwane z DOM. Nale偶y paimta o tym, aby przesta obserwowa elementy, kt贸re zostay ju偶 usunite.

## Kolejne przykady

Poni偶ej znajdziemy dwa w peni dziaajce przykady u偶ycia `Intersection Observer`. Pierwszy z nich korzysta z czystego JavaScript a drugi z React. miao mo偶esz z nich skorzysta w swoich projektach lub u偶y ich jako punktu wyjcia do tworzenia wasnych rozwiza.

### Vanilla JavaScript

<CodePen id="dyamogg" height="600px" />

### React

Sprawd藕 przykad na CodeSandbox.

[![Intersection Observer React](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/p/devbox/intersection-observer-react-x7yj24?embed=1&file=%2Fsrc%2FApp.tsx)

## Podsumowanie

`Intersection Observer` to niezwykle pot偶ne narzdzie, kt贸re ka偶dy frontend deweloper powinien zna. Umo偶liwia ono tworzenie w do prosty i przyjazny spos贸b interaktywnych i dynamicznych interfejs贸w u偶ytkownika bez koniecznoci u偶ycia dodatkowych bibliotek. Zar贸wno w czystym TypeScript / JavaScript, jak i w poczeniu z frameworkami takimi jak React, otwiera szerokie mo偶liwoci w zakresie kontroli nad tym, co i kiedy jest widoczne dla u偶ytkownika.

Dodatkowo, znajomo i waciwe wykorzystanie opcji konfiguracyjnych znaczco rozszerza mo偶liwoci tego API, pozwalajc na stworzenie bardziej interaktywnych i responsywnych aplikacji webowych. Eksperymentowanie z r贸偶nymi kombinacjami tych ustawie mo偶e prowadzi do odkrycia nowych, kreatywnych sposob贸w na wykorzystanie tej technologii w projektach.

Jakie kreatywne zastosowania `Intersection Observer` widziae lub zastosowae w swoich projektach? Podziel si swoimi dowiadczeniami na naszym Discordzie!
